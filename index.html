<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CSV Data Analysis Agent</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header class="app-header">
  <h1>CSV Analysis Agent</h1>
  <div class="header-actions">
    <button id="settings-btn" class="btn">Settings</button>
    <button id="clear-memory-btn" class="btn btn-secondary">Clear Memory</button>
    <button id="hide-assistant-btn" class="btn">Hide Assistant</button>
  </div>
</header>

<div class="main-layout" id="main-layout">
  <main class="content-area">
    <h2>Main Panel</h2>
    <p>This is the main content area.</p>
  </main>

  <div
    class="resizer"
    id="resizer"
    role="separator"
    aria-label="Resize assistant panel"
    aria-orientation="vertical"
    tabindex="0">
  </div>

  <aside class="assistant-sidebar" id="assistant-sidebar">
    <section
      class="assistant-status-hud"
      id="assistant-status-hud"
      aria-live="polite"
      aria-label="Execution status">
      <div class="hud-status-block">
        <p class="hud-label">Execution status</p>
        <p class="hud-title" id="hud-status-text">Idle</p>
        <p class="hud-subtext" id="hud-status-subtext">Waiting for your question</p>
      </div>
      <div class="hud-progress-block">
        <p class="hud-label">Plan progress</p>
        <div class="hud-progress-meta">
          <span id="hud-progress-count">0/0 steps</span>
          <span id="hud-active-tool" class="hud-active-tool">â€”</span>
        </div>
        <div class="hud-progress-bar" aria-hidden="true">
          <span class="hud-progress-fill" id="hud-progress-fill" style="width:0%"></span>
        </div>
      </div>
    </section>
    <div class="message-list" id="message-list">
      <!-- Messages will be dynamically inserted here -->
    </div>
    <div class="assistant-thinking-panel" id="assistant-thinking-panel">
      <div class="insights-toggle-bar">
        <h4>Agent Insights</h4>
        <button
          id="insights-panel-toggle"
          class="toggle-btn insights-panel-toggle"
          type="button"
          aria-expanded="true"
          aria-controls="assistant-thinking-body">
          Hide details
        </button>
      </div>
      <div class="assistant-thinking-body" id="assistant-thinking-body">
      <div class="timeline" id="timeline">
        <div class="section-header">
          <h4>Thinking Log</h4>
          <button id="thinking-log-toggle" class="toggle-btn" aria-expanded="true" aria-controls="thinking-log-body">
            Hide
          </button>
        </div>
        <div class="collapsible thinking-log-body" id="thinking-log-body">
          <ul id="thinking-log-list"></ul>
        </div>
      </div>
      <div class="tool-plan" id="tool-plan">
        <div class="section-header">
          <h4>Next Step</h4>
          <span id="tool-plan-summary" class="plan-summary-chip">Awaiting plan...</span>
        </div>
        <ol id="tool-plan-list" class="plan-step-list">
          <li class="plan-placeholder">No next step determined.</li>
        </ol>
      </div>
      <div class="tool-details" id="tool-details">
        <div class="section-header">
          <h4>Tool Details</h4>
          <button id="tool-details-toggle" class="toggle-btn" aria-expanded="false" aria-controls="tool-details-body">
            Show
          </button>
        </div>
        <div class="collapsible is-collapsed tool-details-body" id="tool-details-body" aria-hidden="true">
          <p class="tool-details-empty">No tool executions yet.</p>
        </div>
      </div>
      </div>
    </div>
    <div class="chat-input-area">
      <textarea id="chat-input" placeholder="Ask a question about your data..."></textarea>
      <button id="send-btn">Send</button>
    </div>
  </aside>
</div>


</body>

<!-- Settings Modal -->
<div id="settings-modal" class="modal" style="display: none;">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h2>Provider Settings</h2>
    
    <div class="form-group">
      <label for="provider-select">LLM Provider</label>
      <select id="provider-select">
        <option value="gemini" selected>Gemini</option>
      </select>
    </div>

    <div class="form-group">
      <label for="api-key-input">API Key</label>
      <input type="password" id="api-key-input" placeholder="Enter your API key...">
    </div>

    <div class="form-group">
      <label for="model-input">Model</label>
      <input list="models" id="model-input" name="model-input" value="gemini-pro">
      <datalist id="models">
        <option value="gemini-pro">
        <option value="gemini-1.5-pro-latest">
      </datalist>
    </div>

    <div class="form-group switch-container">
      <label for="use-local-key-switch">Use Local Key</label>
      <label class="switch">
        <input type="checkbox" id="use-local-key-switch" checked>
        <span class="slider round"></span>
      </label>
    </div>
    
    <div class="modal-footer">
      <button id="test-connection-btn" class="btn">Test Connection</button>
      <button id="save-settings-btn" class="btn primary">Save</button>
    </div>
  </div>
</div>

<script type="module" src="scripts/app.js"></script>

</html>
